---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-drift
  namespace: mlops
data:
  drift-dashboard.json: |
    {
      "title": "MLOps - Data Drift Monitoring",
      "tags": ["mlops", "drift", "monitoring"],
      "timezone": "browser",
      "schemaVersion": 38,
      "version": 1,
      "refresh": "5s",
      "panels": [
        {
          "id": 1,
          "title": "Drift Detected (last 5m)",
          "type": "stat",
          "targets": [
            { "expr": "max_over_time(model_drift_detected[5m])", "refId": "A" }
          ],
          "fieldConfig": {
            "defaults": {
              "mappings": [
                { "type": "value", "options": { "0": { "text": "No Drift" }, "1": { "text": "DRIFT!" } } }
              ],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "value": null, "color": "green" },
                  { "value": 1, "color": "red" }
                ]
              }
            }
          },
          "gridPos": { "h": 6, "w": 4, "x": 0, "y": 0 }
        },
        {
          "id": 2,
          "title": "KS Statistic by Feature",
          "type": "timeseries",
          "targets": [
            { "expr": "model_drift_score", "legendFormat": "{{feature}}", "refId": "A" }
          ],
          "gridPos": { "h": 6, "w": 10, "x": 4, "y": 0 }
        },
        {
          "id": 3,
          "title": "P-Value by Feature",
          "type": "timeseries",
          "targets": [
            { "expr": "model_drift_pvalue", "legendFormat": "{{feature}}", "refId": "A" }
          ],
          "gridPos": { "h": 6, "w": 10, "x": 14, "y": 0 }
        },
        {
          "id": 4,
          "title": "Samples Received Rate (1m)",
          "type": "timeseries",
          "targets": [
            { "expr": "rate(drift_samples_received_total[1m])", "refId": "A" }
          ],
          "gridPos": { "h": 6, "w": 12, "x": 0, "y": 6 }
        },
        {
          "id": 5,
          "title": "Drift Checks Rate (5m)",
          "type": "timeseries",
          "targets": [
            { "expr": "rate(drift_checks_performed_total[5m])", "refId": "A" }
          ],
          "gridPos": { "h": 6, "w": 12, "x": 12, "y": 6 }
        },
        {
          "id": 6,
          "title": "Retraining Triggered (last 1h)",
          "type": "stat",
          "targets": [
            { "expr": "increase(drift_retraining_triggered_total[1h])", "refId": "A" }
          ],
          "gridPos": { "h": 6, "w": 6, "x": 0, "y": 12 }
        }
      ]
    }
